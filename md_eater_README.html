<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>llvm-mos-sdk: README</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">llvm-mos-sdk
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">README </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This directory contains support for <a href="https://eater.net/6502">Ben Eater's Breadboard 6502</a> project.</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Features of the port</h2>
<p>This port has the following features:</p>
<ul>
<li>.text and .rodata segments are placed into ROM, between $8000 and $FFFF.</li>
<li>.data and .bss segments are placed into RAM, between $0200 and $3FFF.</li>
<li>The C stack grows downwards from $4000.</li>
<li>LLVM registers are stored between $E0 and $FF in the zero page.</li>
<li>Support for serial input and output via the W65C51N Asynchronous Communications Interface Adapter (ACIA).</li>
<li>System millisecond tick counter based on the T2 timer in the W65C22 Versatile Interface Adapter (VIA).</li>
</ul>
<h2><a class="anchor" id="autotoc_md2"></a>
Serial console</h2>
<p>The W65C51N Asynchronous Communications Interface Adapter (ACIA) at address $5000 in the breadboard's memory map is used to implement the __putchar() and <a class="el" href="stdio_8h.html#a3e29caa20f7cffe18f410f01278905a8">getchar()</a> functions for the C library.</p>
<p>The ACIA is configured for 19200 bps N-8-1 communications and RTS handshaking. The handshaking lines on the W65C51N should be hooked up as follows:</p>
<ul>
<li>Connect pin 8 (RTS) of the W65C51N to pin 10 (T2IN) of the MAX232.</li>
<li>Connect pin 7 (T2OUT) of the MAX232 to pin 8 (CTS) on the DB9 connector.</li>
<li>Connect pins 9 (CTS), 16 (DCD), and 17 (DSR) of the W65C51N to ground.</li>
<li>Everything else should be connected up the same way as in <a href="https://eater.net/schematics/6502-serial.png">Ben Eater's standard schematic</a>, including the diodes D1 and D2 on the IRQ lines for the chips.</li>
</ul>
<p>Serial output uses busy-waiting after transmitting each character, due to bugs in the W65C51N chip.</p>
<p>Interrupts and RTS handshaking are used to reduce the chance of missing incoming characters. A 256-byte buffer is used to hold incoming data until it can be read. If the buffer fills up, then RTS will be disabled and communications with the host will stop until the program starts reading bytes again with <a class="el" href="stdio_8h.html#a3e29caa20f7cffe18f410f01278905a8">getchar()</a>.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
System tick counter</h2>
<p>The system tick counter can be read by program code with the <a class="el" href="eater_8h.html#a1871228c14c912ca1479cf826ddcb07f">millis()</a> function: </p><pre class="fragment">unsigned long millis(void);
</pre><p>The counter starts at zero at startup time and increments every millisecond. The value will wrap around after 49.7 days.</p>
<p>The <a class="el" href="eater_8h.html#a1871228c14c912ca1479cf826ddcb07f">millis()</a> function is intended for implementing timeouts and delays without using hard-coded delay loops. The built-in <a class="el" href="eater_8h.html#afeb011e80ca695a4e2b66d60d7e2b1aa">delay()</a> function makes it easy to introduce a simple delay up to 65535 milliseconds into your program: </p><pre class="fragment">void delay(unsigned ms);
</pre><h2><a class="anchor" id="autotoc_md4"></a>
Interrupt handling</h2>
<p>The crt0 code takes care of serial and system tick interrupts automatically. After the standard interrupt sources have been handled, the crt0 code will call the irq() function, which must be declared as follows: </p><pre class="fragment">__attribute__((interrupt)) void irq(void)
{
    ...
}
</pre><p>Non-maskable interrupts can also be handled if the program declares the nmi() function as follows: </p><pre class="fragment">__attribute__((interrupt)) void nmi(void)
{
    ...
}
</pre><p>The linker script provides stub definitions for irq() and nmi() in case you don't need them. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
